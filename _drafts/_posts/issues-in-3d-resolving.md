---
title: Issues in 3D resolving
date: '2016-10-10 18:45:00'
layout: post
---
Recently I've had some emails from people who could not get the correct 3D structure using the sketcher. I've investigated these cases and they are both examples of how ambiguity and ill defined chemical standards make the 3D structure resolving tool of MolView imperfect. In this post I want to explain both cases in a bit more detail.

## How MolView resolves 3D structures
MolView uses two different webservices to resolve 3D structures. The first step is to convert the structure into an isomeric [SMILES](http://www.daylight.com/dayhtml/doc/theory/theory.smiles.html) representation. SMILES is basically a standard notation for chemical formulas, except that they are able to store information about rings, stereochemistry, etc. These SMILES are generated by a piece of JavaScript that was written as part of [Ketcher](https://github.com/ggasoftware/ketcher).
When the SMILES is generated, MolView first sends a request to [PubChem](https://pubchem.ncbi.nlm.nih.gov/) through their [REST API](https://pubchem.ncbi.nlm.nih.gov/pug_rest/PUG_REST.html) to see if the structure is in their database. If this is the case, MolView will fetch the 3D structure from PubChem. 3D structures from PubChem have been computed using a conformer sampling algorithm.
However, if the structure cannot be found in PubChem, MolView will send a request to the [Chemical Identifier Resolver](https://cactus.nci.nih.gov/chemical/structure) to convert the SMILES into a 3D structure. This webservices will use a program called [CORINA](https://www.mn-am.com/products/corina). This program generates 3D structures by assembling known crystal structures.

## Case 1: cyclic cis isomers
This case involves cyclic cis isomers. Someone emailed me that MolView resolves a drawing of *cis-1,2-dimethylcyclohexane* into *trans-1,2-dimethylcyclohexane*. Some testing revealed the same issue happens for other simple cyclic compounds as well. The exact reason for this turns out quite difficult to find. The SMILES that are generated for *cis-1,2-dimethylcyclohexane* are `C1CC[C@](C)[C@](C)C1`. That is, the SMILES that are generated when drawing this:

<figure>
  <img src="{{ site.baseurl }}/forestryio/images/no-hydrogen.png" alt="cis-1,2-dimethylcyclohexane without hydrogen atoms">
</figure>

When searching PubChem for this SMILES, we get the entry for *1,2-dimethylcyclohexane*, which is the same molecule but without explicitly defined stereo configuration. The 3D conformation offered by PubChem just so happens to represent the trans isomer (so PubChem has 3 entries for this molecule: [cis-1,2-dimethylcyclohexane](https://pubchem.ncbi.nlm.nih.gov/compound/16628), [trans-1,2-dimethylcyclohexane](https://pubchem.ncbi.nlm.nih.gov/compound/23313) and [1,2-dimethylcyclohexane](https://pubchem.ncbi.nlm.nih.gov/compound/11416)).
Interestingly enough, the 3D structure is resolved correctly when adding 2 hydrogen atoms as depicted below.

<figure>
  <img src="{{ site.baseurl }}/forestryio/images/with-hydrogen.png" alt="cis-1,2-dimethylcyclohexane with two hydrogen atoms">
</figure>

So apparently when those two hydrogen are in the SMILES, PubChem does return the molecule we are looking for. I could not find clear documentation on what the SMILES should look like without the hydrogen, so I can't say if the JavaScript SMILES generator is just wrong. But it's a well known fact that SMILES was originally not well defined. The folks at PubChem even told me they don't know exactly how their webservice interprets SMILES (they use an external piece of software, and there are many different implementations). Fortunately there is now a community effort to create a clear and open specification: http://opensmiles.org/.

## Case 2: sulfur tetrafluoride
The second case concerns sulfur tetrafluoride. When you draw SF4 in MolView, the 3D structure provided by PubChem has a tetrahedral geometry (see the [3D conformer on PubChem](https://pubchem.ncbi.nlm.nih.gov/compound/sulfur_tetrafluoride#section=3D-Conformer)). This is different from the see-saw structure that is often used for the 3D structure of SF4, and someone asked me to explain that difference. I asked the same question to someone at PubChem. He told me that the difference is caused by the conformer generator used by PubChem. I don't understand all the details myself, but basically PubChem uses an algorithm that is tuned to find the protein-bound (bioactive) structure of molecules. For compounds without direct biological relevance, like SF4, this results in inaccurate conformers.
There is some good news though, since PubChem is a data aggregator (meaning they primary collect data from external sources), someone could at one point submit the correct experimental structure for SF4. This has it's own complications but let's not go over them now. If you want to read more about how PubChem works, and how they generate conformers, here are some links.

+ [PubChem3D: a new resource for scientists](http://jcheminf.springeropen.com/articles/10.1186/1758-2946-3-32)
+ [PubChem3D: Conformer generation](http://jcheminf.springeropen.com/articles/10.1186/1758-2946-3-4)
+ [PubChem3D: conformer ensemble accuracy](http://jcheminf.springeropen.com/articles/10.1186/1758-2946-5-1)